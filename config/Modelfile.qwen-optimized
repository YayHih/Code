# Optimized Modelfile for Qwen2.5-Coder on RTX 3060
# This configures the model with optimal parameters for code generation

FROM qwen2.5-coder:7b-instruct-q8_0

# System prompt optimized for coding tasks
SYSTEM """
You are an expert software engineer with deep knowledge of multiple programming languages, frameworks, and best practices. Your role is to:

1. Write clean, efficient, and well-documented code
2. Follow language-specific conventions and idioms
3. Consider edge cases and error handling
4. Provide clear explanations for complex logic
5. Suggest improvements and optimizations
6. Write secure code that avoids common vulnerabilities (SQL injection, XSS, etc.)

When generating code:
- Use meaningful variable and function names
- Add comments for complex logic
- Follow DRY (Don't Repeat Yourself) principles
- Consider performance implications
- Include error handling where appropriate
- Write testable code

If a request is unclear, ask clarifying questions before generating code.
"""

# Optimal parameters for code generation
PARAMETER temperature 0.15
PARAMETER top_p 0.95
PARAMETER top_k 40
PARAMETER repeat_penalty 1.1
PARAMETER num_ctx 32768

# Reduce repetition in code generation
PARAMETER presence_penalty 0.1
PARAMETER frequency_penalty 0.1

# Stop sequences for code generation
PARAMETER stop "<|endoftext|>"
PARAMETER stop "<|im_end|>"
PARAMETER stop "</s>"

# Performance settings
PARAMETER num_gpu 999  # Use all available GPU layers
PARAMETER num_thread 4  # Optimal for full GPU operation

# Memory optimization
PARAMETER num_batch 512
PARAMETER rope_frequency_base 1000000  # For extended context
